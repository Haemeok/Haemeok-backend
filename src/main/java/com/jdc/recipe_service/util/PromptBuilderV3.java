package com.jdc.recipe_service.util;

import com.jdc.recipe_service.domain.dto.recipe.AiRecipeRequestDto;
import com.jdc.recipe_service.domain.dto.user.UserSurveyDto;
import com.jdc.recipe_service.domain.entity.Ingredient;
import com.jdc.recipe_service.domain.entity.Recipe;
import com.jdc.recipe_service.domain.entity.RecipeStep;
import com.jdc.recipe_service.domain.repository.IngredientRepository;
import com.jdc.recipe_service.domain.type.RobotType;
import com.jdc.recipe_service.service.SurveyService;
import org.springframework.stereotype.Component;

import java.util.Collections;
import java.util.Comparator;
import java.util.List;
import java.util.Set;
import java.util.stream.Collectors;

@Component
public class PromptBuilderV3 {

    private final UnitService unitService;
    private final IngredientRepository ingredientRepo;
    private final SurveyService surveyService;

    public PromptBuilderV3(UnitService unitService, IngredientRepository ingredientRepo, SurveyService surveyService) {
        this.unitService = unitService;
        this.ingredientRepo = ingredientRepo;
        this.surveyService = surveyService;
    }

    public String buildPrompt(AiRecipeRequestDto request, RobotType type) {
        UserSurveyDto survey = surveyService.getSurvey(request.getUserId());

        Integer spicePref = (survey != null && survey.getSpiceLevel() != null)
                ? survey.getSpiceLevel()
                : null;

        String allergyPref = (survey != null && survey.getAllergy() != null && !survey.getAllergy().isBlank())
                ? survey.getAllergy()
                : null;

        Set<String> themePrefs =
                (survey != null && survey.getTags() != null && !survey.getTags().isEmpty())
                        ? survey.getTags()
                        : Collections.emptySet();

        List<String> names = request.getIngredients();
        List<String> known = ingredientRepo.findAllByNameIn(names)
                .stream()
                .map(Ingredient::getName)
                .collect(Collectors.toList());
        List<String> unknown = names.stream()
                .filter(n -> !known.contains(n))
                .collect(Collectors.toList());
        String knownList = known.isEmpty() ? "ì—†ìŒ" : String.join(", ", known);
        String unknownList = unknown.isEmpty() ? "ì—†ìŒ" : String.join(", ", unknown);

        String allowedUnits = unitService.unitsAsString();
        String unitMapping = unitService.mappingAsString();
        String tagsJson = themePrefs.isEmpty()
                ? "[]"
                : "[\"" + String.join("\", \"", themePrefs) + "\"]";

        String ingredientsWithUnits = names.stream()
                .map(name -> name + "(" + unitService.getDefaultUnit(name).orElse("g") + ")")
                .collect(Collectors.joining(", "));


        String persona;
        switch (type) {
            case CREATIVE -> persona = "ë„ˆëŠ” ë§¤ìš° ì°½ì˜ì ì´ê³  ìƒˆë¡œìš´ ì¡°í•©ì„ ì¦ê¸°ëŠ” ìš”ë¦¬ ì „ë¬¸ê°€ì•¼.";
            case HEALTHY -> persona = "ë„ˆëŠ” ì˜ì–‘ ê· í˜•ê³¼ ê±´ê°•í•œ ì¡°ë¦¬ë²•ì„ ìµœìš°ì„ ìœ¼ë¡œ ìƒê°í•˜ëŠ” ìš”ë¦¬ ì „ë¬¸ê°€ì•¼.";
            case GOURMET -> persona = "ë„ˆëŠ” í’ë¶€í•˜ê³  ê¹Šì€ ë§›ì„ íƒë‹‰í•˜ë©°, í”„ë¦¬ë¯¸ì—„ ì¬ë£Œë¡œ ê³ ê¸‰ìŠ¤ëŸ½ê³  ì„¬ì„¸í•œ ìš”ë¦¬ë¥¼ ì„ ë³´ì´ëŠ” ë¯¸ì‹ê°€ì•¼.";
            default -> persona = "ë„ˆëŠ” ì¬ë£Œì˜ í’ë¯¸ì™€ ì¡°ë¦¬ ì›ë¦¬ë¥¼ ê·¹ëŒ€í™”í•˜ì—¬ **ê°€ì¥ ë§›ìˆê³  í’ë¶€í•œ ë§›ì„ êµ¬í˜„í•˜ëŠ” ì „ë¬¸ ìš”ë¦¬ì‚¬ì•¼.**";
        }

        String cookingTimePart = (request.getCookingTime() != null && request.getCookingTime() > 0)
                ? String.format("- í¬ë§ ì¡°ë¦¬ ì‹œê°„: %dë¶„ ì´ë‚´", request.getCookingTime())
                : "- í¬ë§ ì¡°ë¦¬ ì‹œê°„ ì •ë³´ê°€ ì œê³µë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤. AI ëª¨ë¸ì´ ìë™ìœ¼ë¡œ ì˜ˆìƒ ì¡°ë¦¬ ì‹œê°„ì„ ì¶”ì •í•˜ì„¸ìš”.";

        String servingsPart = (request.getServings() != null && request.getServings() > 0)
                ? String.format("- ì¸ë¶„ ìˆ˜: %.1fì¸ë¶„", request.getServings())
                : "- ì¸ë¶„ ìˆ˜ ì •ë³´ê°€ ì œê³µë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤. AI ëª¨ë¸ì´ ì ì ˆíˆ íŒë‹¨í•˜ì—¬ ì‘ì„±í•˜ì„¸ìš”.";


        String systemAndBaseRules = String.format("""
                [SYSTEM] ë„ˆëŠ” ìš”ë¦¬ ì „ë¬¸ê°€ AIë¡œì„œ, ì˜¤ì§ í•˜ë‚˜ì˜ ì™„ì „í•œ JSONë§Œ ì¶œë ¥í•´ì•¼ í•©ë‹ˆë‹¤.
                ì„¤ëª…, ì£¼ì„, ë§ˆí¬ë‹¤ìš´, ```json ë“± ì ˆëŒ€ í¬í•¨í•˜ì§€ ë§ˆì„¸ìš”.
                **ë°˜ë“œì‹œ ì•„ë˜ ê·œì¹™ì„ 100%% ì¤€ìˆ˜í•˜ì—¬ ë ˆì‹œí”¼ë¥¼ ìƒì„±í•˜ì„¸ìš”.**
                
                %s
                
                **[ë‹¨ìœ„ ë° DB ì¬ë£Œ ì •ë³´]**
                - í—ˆìš© ë‹¨ìœ„: [%s]
                - ë‹¤ìŒ ì¬ë£Œë“¤ì€ ë°˜ë“œì‹œ ê¸°ë³¸ ë‹¨ìœ„ë¡œ ì‘ì„±í•´ì•¼ í•©ë‹ˆë‹¤:
                [%s]
                â€» 'unit' í•„ë“œëŠ” ìœ„ ë§¤í•‘ì—ì„œ ì§€ì •ëœ ë‹¨ìœ„ ì™¸ì—ëŠ” ì ˆëŒ€ ì‚¬ìš© ë¶ˆê°€í•©ë‹ˆë‹¤.
                
                - DBì— ì´ë¯¸ ìˆëŠ” ì¬ë£Œ: [%s]
                - DBì— ì—†ëŠ” ì¬ë£Œ: [%s]
                
                ì˜¤ì§ ë‹¨ í•˜ë‚˜ì˜ JSON ê°ì²´ í˜•íƒœë¡œë§Œ ì¶œë ¥í•˜ì„¸ìš”.
                ì•„ë˜ ê·œì¹™ì„ ë°˜ë“œì‹œ ì¤€ìˆ˜í•˜ì—¬ ë ˆì‹œí”¼ë¥¼ ìƒì„±í•˜ì„¸ìš”.
                """, persona, allowedUnits, unitMapping, knownList, unknownList);


        String jsonFormatRules = """
                **[JSON ì¶œë ¥ í˜•ì‹ ê·œì¹™]**
                
                --- [ğŸš¨ CRITICAL WARNING: ìˆ«ì í•„ë“œ NULL/ê³µë°± ì ˆëŒ€ ê¸ˆì§€ ğŸš¨] ---
                - **ëª¨ë“  ìˆ«ì í•„ë“œ**(`quantity`, `customPrice`, `customCalories`, `customCarbohydrate`, `customProtein`, `customFat`, `customSugar`, `customSodium`, `marketPrice`, `cookingTime`, `servings`)ëŠ” **0.00 ì´ìƒì˜ ìœ íš¨í•œ ìˆ«ìë§Œ** í—ˆìš©ë©ë‹ˆë‹¤.
                - **ì ˆëŒ€ë¡œ ë¹ˆ ë¬¸ìì—´("") ë˜ëŠ” null ê°’ì„ ì‚¬ìš©í•˜ì§€ ë§ˆì„¸ìš”.** ì´ë¥¼ ìœ„ë°˜í•˜ë©´ JSON ì „ì²´ê°€ ë¬´íš¨í™”ë˜ê³  ì—ëŸ¬ê°€ ë°œìƒí•©ë‹ˆë‹¤.
                ---
                
                **[JSON ì„¸ë¶€ í•„ë“œ ê·œì¹™]**
                ì•„ë˜ëŠ” JSON í•„ë“œ ê°ê°ì˜ ì„¸ë¶€ ê·œì¹™ì…ë‹ˆë‹¤. ë°˜ë“œì‹œ ì§€ì¼œì£¼ì„¸ìš”.
                
                --- "title" í•„ë“œ (ì œëª© ê°•í™” ê·œì¹™) ---
                - ì œëª©ì€ **ì£¼ì¬ë£Œ + ë§› í‘œí˜„ + ìš”ë¦¬ëª…** í˜•ì‹ìœ¼ë¡œ ì‘ì„±
                - ì˜ˆ: 'ë§¤ì½¤ ë¼ì§€ê³ ê¸° ê¹€ì¹˜ì°Œê°œ', 'ì–¼í°í•œ ë‘ë¶€ ê¹€ì¹˜ì°Œê°œ'
                - ë„ˆë¬´ ê°„ê²°í•œ 'ê¹€ì¹˜ì°Œê°œ' ê¸ˆì§€
                - ì¸ë¶„/ì‹œê°„ í¬í•¨ ê°€ëŠ¥ (ì˜ˆ: '2ì¸ë¶„ 25ë¶„ ë§¤ì½¤ ê¹€ì¹˜ì°Œê°œ')
                
                --- "dishType" í•„ë“œ (ìš”ë¦¬ ìœ í˜• ê·œì¹™) ---
                - `dishType`ì€ ë°˜ë“œì‹œ ìš”ì²­ëœ ê°’("%s")ì„ **ê·¸ëŒ€ë¡œ ì‚¬ìš©**í•˜ê±°ë‚˜ (ìš”ì²­ì— ì—†ì„ ì‹œ) ì•„ë˜ ëª©ë¡ì—ì„œ í•˜ë‚˜ë§Œ ì„ íƒí•˜ì„¸ìš”:
                  ë³¶ìŒ, êµ­/ì°Œê°œ/íƒ•, êµ¬ì´, ë¬´ì¹¨/ìƒëŸ¬ë“œ, íŠ€ê¹€/ë¶€ì¹¨, ì°œ/ì¡°ë¦¼, ì˜¤ë¸ìš”ë¦¬, ìƒì‹/íšŒ, ì ˆì„/í”¼í´ë¥˜, ë°¥/ë©´/íŒŒìŠ¤íƒ€, ë””ì €íŠ¸/ê°„ì‹ë¥˜
                - **ì ˆëŒ€ ë¹ˆ ë¬¸ìì—´("")ì´ë‚˜ ê³µë°±ìœ¼ë¡œ ì¶œë ¥ë˜ì–´ì„œëŠ” ì•ˆ ë©ë‹ˆë‹¤.**
                
                --- "description" í•„ë“œ ---
                - ìŒì‹ì— ëŒ€í•œ ì„¤ëª…ê³¼ í›„ê¸°ë¥¼ ì²¨ë¶€í•˜ì„¸ìš”.
                
                --- "ingredients" í•„ë“œ (ì¬ë£Œ í•„ë“œ ê°•ì œ ê·œì¹™ - ë°˜ë“œì‹œ ì¤€ìˆ˜) ---
                - DBì— ì—†ëŠ” ì¬ë£Œ(%s)ëŠ” **ë°˜ë“œì‹œ** ì•„ë˜ 2ê°œ í•„ë“œ í¬í•¨:
                  - `customPrice`: **í•´ë‹¹ ì¬ë£Œì˜ Quantity(ì´ëŸ‰)ì— ëŒ€í•œ ì „ì²´ ì›ê°€** (ì •ìˆ˜, ì›).
                  - `customCalories`: **í•´ë‹¹ ì¬ë£Œì˜ Quantity(ì´ëŸ‰)ì— ëŒ€í•œ ì „ì²´ ì¹¼ë¡œë¦¬** (ì†Œìˆ˜ì  í¬í•¨ ìˆ«ì, kcal)
                  - `customCarbohydrate`: **í•´ë‹¹ ì¬ë£Œì˜ Quantity(ì´ëŸ‰)ì— ëŒ€í•œ ì „ì²´ íƒ„ìˆ˜í™”ë¬¼** (ì†Œìˆ˜ì  í¬í•¨ ìˆ«ì, g)
                  - `customProtein`: **í•´ë‹¹ ì¬ë£Œì˜ Quantity(ì´ëŸ‰)ì— ëŒ€í•œ ì „ì²´ ë‹¨ë°±ì§ˆ** (ì†Œìˆ˜ì  í¬í•¨ ìˆ«ì, g)
                  - `customFat`: **í•´ë‹¹ ì¬ë£Œì˜ Quantity(ì´ëŸ‰)ì— ëŒ€í•œ ì „ì²´ ì§€ë°©** (ì†Œìˆ˜ì  í¬í•¨ ìˆ«ì, g)
                  - `customSugar`: **í•´ë‹¹ ì¬ë£Œì˜ Quantity(ì´ëŸ‰)ì— ëŒ€í•œ ì „ì²´ ë‹¹ë¥˜** (ì†Œìˆ˜ì  í¬í•¨ ìˆ«ì, g)
                  - `customSodium`: **í•´ë‹¹ ì¬ë£Œì˜ Quantity(ì´ëŸ‰)ì— ëŒ€í•œ ì „ì²´ ë‚˜íŠ¸ë¥¨** (ì†Œìˆ˜ì  í¬í•¨ ìˆ«ì, mg)
                  - ì´ í•„ë“œ ëˆ„ë½ ì‹œ ì¶œë ¥ ì „ì²´ ë¬´íš¨
                - DBì— ìˆëŠ” ì¬ë£ŒëŠ” `customPrice`, `customCalories`,'customCarbohydrate',`customProtein`,`customFat`,`customSugar`,`customSodium` **ì ˆëŒ€ í¬í•¨ ê¸ˆì§€**
                - ë˜í•œ ëª¨ë“  ì¬ë£Œì˜ quantityëŠ” ìš”ì²­ëœ ì¸ë¶„ ìˆ˜ì— ë§ì¶”ì–´ ìë™ìœ¼ë¡œ ì¡°ì ˆí•´ì•¼ í•˜ë©°, ê¸°ë³¸ 1ì¸ë¶„ ê¸°ì¤€ìœ¼ë¡œ ìì—°ìŠ¤ëŸ½ê²Œ í™•ì¥í•˜ê±°ë‚˜ ì¶•ì†Œëœ ê°’ìœ¼ë¡œ ì‘ì„±í•´ì•¼ í•©ë‹ˆë‹¤. ì¸ë¶„ ìˆ˜ê°€ ì œê³µë˜ì§€ ì•Šì€ ê²½ìš° ëª¨ë¸ì´ ì ì ˆí•œ ê¸°ë³¸ ì¸ë¶„ì„ ê°€ì •í•˜ì—¬ ì¼ê´€ì„± ìˆê²Œ ê³„ì‚°í•˜ì„¸ìš”.
                - ì¬ë£Œë³„ ê¸°ë³¸ ë‹¨ìœ„ ë§¤í•‘: {%s}
              
                --- "steps" í•„ë“œ (ë‹¨ê³„ ê·œì¹™) ---
                - "steps" ë°°ì—´ì˜ "action" í•„ë“œëŠ” ë°˜ë“œì‹œ ì•„ë˜ 19ê°œ ì¤‘ í•˜ë‚˜ë§Œ ì‚¬ìš©í•´ì•¼ í•©ë‹ˆë‹¤:
                  ì°ê¸°, ë‹¤ì§€ê¸°, ì±„ì°ê¸°, ì†ì§ˆí•˜ê¸°, ë³¶ê¸°, íŠ€ê¸°ê¸°, ë“ì´ê¸°, ì°Œê¸°(ìŠ¤íŒ€), ë°ì¹˜ê¸°, êµ¬ì´, ì¡°ë¦¼, ë¬´ì¹˜ê¸°, ì ˆì´ê¸°, ë‹´ê·¸ê¸°(ë§ˆë¦¬ë„¤ì´ë“œ), ì„ê¸°, ì “ê¸°, ë²„ë¬´ë¦¬ê¸°, ë¡œìŠ¤íŒ…, ìºëŸ¬ë©œë¼ì´ì¦ˆ, ë¶€ì¹˜ê¸°
                - ëª¨ë“  í•„ë“œëŠ” ì˜ë¯¸ ìˆëŠ” í•œê¸€ ë‚´ìš©ì´ì–´ì•¼ í•˜ê³ , ì ˆëŒ€ë¡œ ë¹ˆê°’("")ì´ ë  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.
                - "steps" ë°°ì—´ ì•ˆì˜ ê° ê°ì²´ëŠ” "stepNumber", "instruction", "action" í‚¤ë¥¼ ëª¨ë‘ í¬í•¨í•´ì•¼ í•©ë‹ˆë‹¤.
                
                --- "tags" í•„ë“œ (íƒœê·¸ ê·œì¹™) ---
                - ìš”ì²­í•œ íƒœê·¸ ë°°ì—´ %sì˜ ì›ì†Œë¥¼ ì ˆëŒ€ë¡œ ìˆ˜ì •Â·ëˆ„ë½í•˜ì§€ ë§ ê²ƒ.
                - ë§Œì•½ ìš”ì²­ íƒœê·¸ê°€ []ë¼ë©´, AIëŠ” ì•„ë˜ í—ˆìš© ëª©ë¡ ì¤‘ ìŒì‹ ë¶„ìœ„ê¸°ì— ë§ëŠ” íƒœê·¸ë¥¼ **ìµœëŒ€ 3ê°œ** ê³¨ë¼ì„œ ë°˜í™˜í•´ì•¼ í•©ë‹ˆë‹¤:
                  ğŸ  í™ˆíŒŒí‹°, ğŸŒ¼ í”¼í¬ë‹‰, ğŸ•ï¸ ìº í•‘, ğŸ¥— ë‹¤ì´ì–´íŠ¸ / ê±´ê°•ì‹, ğŸ‘¶ ì•„ì´ì™€ í•¨ê»˜, ğŸ½ï¸ í˜¼ë°¥, ğŸ¶ ìˆ ì•ˆì£¼, ğŸ¥ ë¸ŒëŸ°ì¹˜, ğŸŒ™ ì•¼ì‹, âš¡ ì´ˆìŠ¤í”¼ë“œ / ê°„ë‹¨ ìš”ë¦¬, ğŸ‰ ê¸°ë…ì¼ / ëª…ì ˆ, ğŸ± ë„ì‹œë½, ğŸ”Œ ì—ì–´í”„ë¼ì´ì–´, ğŸ² í•´ì¥
                
                [CRITICAL íƒœê·¸ ì„ íƒ ì¡°ê±´] ì„¹ì…˜ ë‚´ ì „ì²´ ê·œì¹™
                - **Servings ê¸°ì¤€:** Servingsê°€ **1ì¸ë¶„ì¼ ë•Œë§Œ** 'ğŸ½ï¸ í˜¼ë°¥' íƒœê·¸ë¥¼ ì„ íƒ ê°€ëŠ¥í•©ë‹ˆë‹¤.
                - **ì‹œê°„ ê¸°ì¤€:** 'âš¡ ì´ˆìŠ¤í”¼ë“œ / ê°„ë‹¨ ìš”ë¦¬' íƒœê·¸ëŠ” CookingTimeì´ **15ë¶„ ì´ë‚´**ì¼ ê²½ìš°ì—ë§Œ ì„ íƒ ê°€ëŠ¥í•©ë‹ˆë‹¤.
                - **ì¡°ë¦¬ ë°©ì‹ ê¸°ì¤€:** 'ğŸ”Œ ì—ì–´í”„ë¼ì´ì–´' íƒœê·¸ëŠ” ë ˆì‹œí”¼ì˜ **`cookingTools` í•„ë“œì— 'ì˜¤ë¸' ë˜ëŠ” 'ì—ì–´í”„ë¼ì´ì–´'ê°€ ëª…ì‹œì ìœ¼ë¡œ í¬í•¨**ë˜ì–´ ìˆê±°ë‚˜, `dishType`ì´ **'êµ¬ì´'** ë˜ëŠ” **'íŠ€ê¹€/ë¶€ì¹¨'**ì— í•´ë‹¹ë  ê²½ìš°ì—ë§Œ ì„ íƒ ê°€ëŠ¥í•©ë‹ˆë‹¤.
                - **ê±´ê°• ê¸°ì¤€:** 'ğŸ¥— ë‹¤ì´ì–´íŠ¸ / ê±´ê°•ì‹' íƒœê·¸ëŠ” **ì„¤íƒ•, íŠ€ê¹€ë¥˜, ê°€ê³µìœ¡(í–„/ì†Œì‹œì§€)**ì´ ì£¼ì¬ë£Œë¡œ ì‚¬ìš©ë˜ì§€ ì•Šê³ , **ì±„ì†Œë‚˜ ë‹¨ë°±ì§ˆ ìœ„ì£¼**ì˜ ì‹ë‹¨ì¼ ê²½ìš°ì—ë§Œ ì„ íƒ ê°€ëŠ¥í•©ë‹ˆë‹¤.
                - **ë‚˜ë¨¸ì§€ íƒœê·¸ (í™ˆíŒŒí‹°, ì•¼ì‹, ìˆ ì•ˆì£¼ ë“±):** ë ˆì‹œí”¼ì˜ ë¶„ìœ„ê¸°ë‚˜ ì¬ë£Œì— ë”°ë¼ AIê°€ ììœ ë¡­ê²Œ íŒë‹¨í•˜ì—¬ ì„ íƒí•©ë‹ˆë‹¤.
                - **ë°°ì œ ê·œì¹™:** Servingsê°€ 2ì¸ë¶„ ì´ˆê³¼ì¼ ê²½ìš° 'ğŸ½ï¸ í˜¼ë°¥' íƒœê·¸ë¥¼ ì ˆëŒ€ ì„ íƒ ë¶ˆê°€. ì§€ë°©/ì¹¼ë¡œë¦¬ê°€ ë†’ê±°ë‚˜ ì¡°ë¦¬ ì‹œê°„ì´ 20ë¶„ ì´ˆê³¼(ì˜¤ë¸/ì°œ í¬í•¨)ì¼ ê²½ìš° 'âš¡ ì´ˆìŠ¤í”¼ë“œ / ê°„ë‹¨ ìš”ë¦¬' ë˜ëŠ” 'ğŸ¥— ë‹¤ì´ì–´íŠ¸ / ê±´ê°•ì‹' íƒœê·¸ë¥¼ ì ˆëŒ€ ì„ íƒ ë¶ˆê°€.
                
                --- "marketPrice" í•„ë“œ (ë°°ë‹¬ ê°€ê²© ê·œì¹™) ---
                - ë ˆì‹œí”¼ ì „ì²´ **ì‹¤ì œ ì˜ˆìƒ ë°°ë‹¬ ê°€ê²©** (ì •ìˆ˜, ì›)ì„ í•œêµ­ ë°°ë‹¬ ì•± ê¸°ì¤€ìœ¼ë¡œ í˜„ì‹¤ì ìœ¼ë¡œ ì¶”ì •í•˜ì„¸ìš”.
                - **[CRITICAL PRICE RULE]** ë°°ë‹¬ ê°€ê²©ì€ **ì›ê°€, ì¸ê±´ë¹„, í¬ì¥ë¹„, ë§ˆì§„**ì„ ëª¨ë‘ í¬í•¨í•´ì•¼ í•˜ë¯€ë¡œ, **ì ˆëŒ€ë¡œ ì €ë ´í•œ ê°€ê²©ìœ¼ë¡œ ì±…ì •í•´ì„œëŠ” ì•ˆ ë©ë‹ˆë‹¤.** ì¼ë°˜ì ì¸ **ë°°ë‹¬ ì „ë¬¸ì **ì˜ ë©”ë‰´íŒ ê°€ê²©(ì˜ˆ: 1ì¸ë¶„ë‹¹ ìµœì†Œ 9,000ì› ì´ìƒ)ì„ ê¸°ì¤€ìœ¼ë¡œ **ì¶©ë¶„íˆ í˜„ì‹¤ì ì¸ ê³ ê°€**ë¡œ ì„¤ì •í•˜ì„¸ìš”.           
                
                --- "cookingTips" í•„ë“œ (íŒ ê·œì¹™) ---
                - **ì„œë¹™ / ë§› ê°•í™” / ì¬í™œìš© / ë³´ì¡° ì¬ë£Œ ëŒ€ì²´ íŒ 3~5ê°œ**ë¥¼ ìƒì„±í•˜ì„¸ìš”.
                - ë³´ì¡° ì¬ë£Œ ëŒ€ì²´ ê°€ëŠ¥í•˜ì§€ë§Œ, ìš”ë¦¬ ë³¸ì—°ì˜ ë§›ê³¼ ì·¨ì§€ë¥¼ í•´ì¹˜ì§€ ì•ŠëŠ” ë²”ìœ„ì—ì„œë§Œ í—ˆìš©ë©ë‹ˆë‹¤. (ì˜ˆ: ê³ ì¶§ê°€ë£¨ â†’ ì²­ì–‘ê³ ì¶” O)
                - ë°˜ë“œì‹œ ë¬¸ì¥ ë‹¨ìœ„ë¡œ ì´ì–´ì„œ ì‘ì„±í•˜ê³ , ìˆ«ìë‚˜ ëª©ë¡ í‘œì‹œ(1, 2, 3...)ëŠ” ì‚¬ìš©í•˜ì§€ ë§ˆì„¸ìš”.

                --- ê¸°íƒ€ í•„ë“œ ---
                - `cookingTime`, `cookingTools`, `servings`ëŠ” ìš”ì²­ ì¡°ê±´ê³¼ ìš”ë¦¬ ì›ë¦¬ì— ë§ì¶° ì ì ˆíˆ ì‘ì„±í•˜ì„¸ìš”.
                
                
                [ë‹¨ê³„ ì„¤ëª… ê·œì¹™ - ì „ë¬¸ ë ˆì‹œí”¼ì²˜ëŸ¼ ìì—°ìŠ¤ëŸ½ê³  í’ˆì§ˆê° ìˆê²Œ]
                - **ê° ë‹¨ê³„ëŠ” ìì—°ìŠ¤ëŸ½ê³  ë…¼ë¦¬ì ì¸ íë¦„ìœ¼ë¡œ êµ¬ì„±** (ì¬ë£Œ ì†ì§ˆ â†’ í’ë¯¸ ë² ì´ìŠ¤ â†’ ë³¸ ì¡°ë¦¬ â†’ ë§ˆë¬´ë¦¬)
                - **[CRITICAL ë‹¨ê³„ ê·œì¹™]** ì¬ë£Œ ì†ì§ˆ(ì°ê¸°, ë‹¤ì§€ê¸°) ë‹¨ê³„ì™€ ì–‘ë…ì¥/ë§ˆë¦¬ë„¤ì´ë“œ ì¤€ë¹„(ì„ê¸°, ë‹´ê·¸ê¸°) ë‹¨ê³„ë¥¼ **ë…¼ë¦¬ì ìœ¼ë¡œ ë¶„ë¦¬**í•˜ì—¬ ëª…í™•ì„±ì„ ë†’ì´ì„¸ìš”. ì¬ë£Œ ì†ì§ˆ ë‹¨ê³„ë¥¼ ëë‚¸ í›„ ë‹¤ìŒ ë‹¨ê³„ì—ì„œ ì–‘ë… ì¤€ë¹„ë¥¼ ì‹œì‘í•˜ì„¸ìš”.
                - **ì´ˆë³´ìë„ ë°”ë¡œ ë”°ë¼í•  ìˆ˜ ìˆë„ë¡ (ë¬˜ì‚¬ ê°•í™”):** ë¶ˆ ì„¸ê¸°, ì‹œê°„, ì¬ë£Œ ìƒíƒœ ë³€í™”ë¥¼ êµ¬ì²´ì ì¸ í˜•ìš©ì‚¬ë‚˜ ë¶€ì‚¬ë¥¼ ì‚¬ìš©í•˜ì—¬ ë¬˜ì‚¬í•˜ì„¸ìš”.
                - **ë¬¸ì¥ êµ¬ì„±:** 2~3ê°œ ë¬¸ì¥, ìµœëŒ€ 150ì ì´ë‚´ë¡œ ì‘ì„±í•˜ê³  ëì€ 'ì£¼ì„¸ìš”', 'í•˜ì„¸ìš”', 'í•©ë‹ˆë‹¤' ë“± ìì—°ìŠ¤ëŸ½ê²Œ ë§ˆë¬´ë¦¬í•˜ì„¸ìš”.
                - **ë³´ì¡° ì„¤ëª…:** ì¡°ë¦¬ ê³¼ì •ì— ëŒ€í•œ ë³´ì¡° ì„¤ëª…ì´ë‚˜ íŒì€ ë³„ë„ë¡œ ë¶„ë¦¬í•˜ì§€ ì•Šê³ , í˜„ì¬ ë‹¨ê³„ì˜ instruction ë’¤ì— ìì—°ìŠ¤ëŸ¬ìš´ ë‹¤ìŒ ë¬¸ì¥ìœ¼ë¡œ ì—°ê²°í•˜ì—¬ ì¶”ê°€í•˜ì„¸ìš”.
                
                
                [ìš”ë¦¬ ì›ë¦¬ ê·œì¹™]
                1. **(í•µì‹¬)** ì°Œê°œÂ·ë³¶ìŒÂ·ì¡°ë¦¼ ìš”ë¦¬ì—ì„œëŠ” ê¸°ë¦„ì— ì£¼ì¬ë£Œë‚˜ í–¥ì‹ ì±„(ë§ˆëŠ˜Â·íŒŒ ë“±)ë¥¼ ë¨¼ì € ë³¶ì•„ í’ë¯¸ì˜ ê¸°ì´ˆë¥¼ ë‹¤ì§€ëŠ” ê³¼ì •ì„ ìµœìš°ì„ ìœ¼ë¡œ ê³ ë ¤í•˜ì„¸ìš”.
                2. íš¨ìœ¨ì ì´ê³  ë…¼ë¦¬ì ì¸ ìˆœì„œë¡œ ë‹¨ê³„ë¥¼ êµ¬ì„±í•˜ì„¸ìš”.
                3. ìš”ì²­ì— ì—†ë”ë¼ë„ í•„ìˆ˜ ë³´ì¡° ì¬ë£Œë¥¼ ììœ ë¡­ê²Œ ì¶”ê°€í•˜ê³  'ingredients'ì— í¬í•¨ì‹œí‚¤ì„¸ìš”.
                4. **[CRITICAL] ê° ì¬ë£Œì˜ ì–‘ì€ ìš”ì²­ëœ ì¸ë¶„ ìˆ˜(servings)ì— 100%% ë¹„ë¡€í•˜ì—¬ ì¡°ì •í•  ê²ƒ.**
                   - **(ìµœìš°ì„  ë¬´ê²Œ ê¸°ì¤€)** AIëŠ” ëª¨ë“  ì£¼ì¬ë£Œ(ìœ¡ë¥˜, í•´ì‚°ë¬¼, ìƒì„ )ì— ëŒ€í•´ **1ì¸ë¶„ë‹¹ ìµœì†Œ 180g ~ 200gì˜ í¬ë§Œê°**ì„ ì¶©ì¡±í•˜ë„ë¡ ì¶”ì •í•´ì•¼ í•©ë‹ˆë‹¤.
                   - **[ê°œìˆ˜-ë¬´ê²Œ ê³„ì‚° ê³µì‹ ì ìš©]** ì£¼ì¬ë£Œê°€ 'ë§ˆë¦¬'ë‚˜ 'ê°œ' ë‹¨ìœ„ì¼ ê²½ìš°, **1ë§ˆë¦¬(ê°œ)ë‹¹ í‰ê·  ë¬´ê²Œë¥¼ ë…¼ë¦¬ì ìœ¼ë¡œ ì¶”ì •**í•˜ê³ , **1ì¸ë¶„ ìµœì†Œ ë¬´ê²Œ(180g)ë¥¼ í•´ë‹¹ ë¬´ê²Œë¡œ ë‚˜ëˆ„ì–´ í•„ìš”í•œ ê°œìˆ˜**ë¥¼ ê³„ì‚°í•´ì•¼ í•©ë‹ˆë‹¤.
                   - **[CRITICAL ì œì™¸]** **ì–‘ë…ë¥˜, í–¥ì‹ ë£Œ, ê°ì¹ ë§› ì¬ë£Œ(ì˜ˆ: ê³ ì¶”ì¥, ì¯”ìœ , ê°€ë‹¤ë‘ì–´í¬)**ëŠ” ì´ ë¬´ê²Œ ê¸°ì¤€ì„ ë”°ë¥´ì§€ ì•Šìœ¼ë©°, **ìš”ë¦¬ì˜ ë§›ê³¼ í’ë¯¸ë¥¼ ë‚´ëŠ” ìµœì†Œí•œì˜ í•©ë¦¬ì ì¸ ì–‘**ìœ¼ë¡œ ì„¤ì •ë˜ì–´ì•¼ í•©ë‹ˆë‹¤.
                   - ì–‘ë… ë° ë¶€ì¬ë£Œë„ ì£¼ì¬ë£Œì˜ ì–‘ì— ë§ì¶° í’ë¯¸ë¥¼ ì¶©ë¶„íˆ ë‚¼ ìˆ˜ ìˆë„ë¡ ë¹„ë¡€í•˜ì—¬ ì¦ê°€ì‹œí‚¬ ê²ƒ.
                5. **[í•µì‹¬: ë§›ì˜ ì™„ì„±ë„ ëª©í‘œ]** ë ˆì‹œí”¼ëŠ” **ì‹¤ì œ ì „ë¬¸ ìš”ë¦¬ì‚¬ê°€ ë§Œë“  ê²ƒì²˜ëŸ¼ ê¹Šì€ ë§›**ì„ ë‚´ì•¼ í•˜ë©°, **ë§›ì˜ ê¹Šì´(ë‹¨ì§  ê· í˜•, ê°ì¹ ë§›)**ì™€ **í’ë¯¸(í–¥)**ë¥¼ ìµœìš°ì„  ëª©í‘œë¡œ êµ¬í˜„í•˜ì„¸ìš”.
                   - **(ê¸°ëŠ¥ì  ì¶©ì¡±)** ë³¶ìŒ/ì¡°ë¦¼ ìš”ë¦¬ ì‹œ, ìœ¡ë¥˜ë‚˜ í•´ì‚°ë¬¼ì˜ **ì¡ë‚´ë¥¼ ì œê±°**í•˜ëŠ” ì¬ë£Œ(ì˜ˆ: ë¯¸ë¦¼, ì²­ì£¼)ë¥¼ ì‚¬ìš©í•˜ê³ , ë§ˆì§€ë§‰ì— **ê³ ì†Œí•œ ë§ˆë¬´ë¦¬ í–¥**ì„ ë”í•˜ëŠ” ì¬ë£Œ(ì˜ˆ: ì°¸ê¸°ë¦„, ë“¤ê¸°ë¦„)ë¥¼ **ìš”ë¦¬ì˜ ì¢…ë¥˜ì— ë§ì¶° ììœ ë¡­ê²Œ ì„ íƒ**í•˜ì„¸ìš”.
                   - **(í¸í–¥ ì œê±°)** AIê°€ ìì²´ì ìœ¼ë¡œ ê°€ì§„ **ê±´ê°•ì´ë‚˜ ë‹¤ì´ì–´íŠ¸ í¸í–¥ì„ ë²„ë¦¬ê³ **, **ê°€ì¥ ë§›ìˆê³  í’ë¶€í•œ ê²°ê³¼ë¬¼**ì„ ë§Œë“¤ë„ë¡ ì–‘ë…ì„ **ì¶©ë¶„í•˜ê³  ë³µí•©ì **ìœ¼ë¡œ ì„¤ì •í•´ì•¼ í•©ë‹ˆë‹¤.
                6. **[ìƒˆ ì¬ë£Œ ë‹¨ìœ„ ì¶”ë¡  ì›ì¹™]** DBì— ì—†ëŠ” **ìƒˆë¡œìš´ ì¬ë£Œ**ì˜ ë‹¨ìœ„ë¥¼ ì„¤ì •í•  ë•Œ, í•´ë‹¹ ì¬ë£Œì˜ **ë¬¼ë¦¬ì  íŠ¹ì„±**ì— ë”°ë¼ ê°€ì¥ í˜„ì‹¤ì ì¸ ë‹¨ìœ„ë¥¼ ì„ íƒí•´ì•¼ í•©ë‹ˆë‹¤.
                    - **ì•¡ì²´ë¥˜ (ì˜¤ì¼, ìš°ìœ , ì²­ì£¼ ë“±):** ë¬´ê²Œ(`g`) ëŒ€ì‹  **ë¶€í”¼ ë‹¨ìœ„(`ml`, `í°ìˆ `, `ì‘ì€ìˆ `)**ë¥¼ ìš°ì„  ì‚¬ìš©í•©ë‹ˆë‹¤.
                    - **ë¶„ë§ë¥˜ (ê°€ë£¨, í–¥ì‹ ë£Œ):** ë¬´ê²Œ(`g`) ë˜ëŠ” **ìš©ëŸ‰ ë‹¨ìœ„(`í°ìˆ `, `ì‘ì€ìˆ `)**ë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤.
                    - **ê³ í˜•ë¬¼ (ì±„ì†Œ, ê³ ê¸°):** ë¬´ê²Œ(`g`)ë¥¼ ê¸°ë³¸ìœ¼ë¡œ í•˜ë˜, í¬ê¸°ê°€ ì¼ì •í•˜ë©´ **ê°œìˆ˜(`ê°œ`, `ëª¨`, `ë§ˆë¦¬`)**ë¥¼ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
                """.formatted(
                request.getDishType() != null && !request.getDishType().isBlank() ? request.getDishType() : "",
                unknownList,
                unitMapping,
                tagsJson
        );


        String fewShotExample = """
                {
                  "title": "ìƒ˜í”Œ ìš”ë¦¬ ì œëª©",
                  "dishType": "ë³¶ìŒ",
                  "description": "ì´ê²ƒì€ JSON êµ¬ì¡°ë¥¼ ë³´ì—¬ì£¼ê¸° ìœ„í•œ ìƒ˜í”Œ ë ˆì‹œí”¼ì…ë‹ˆë‹¤. ë‚´ìš©ì„ ë³µì‚¬í•˜ì§€ ë§ˆì„¸ìš”.",
                  "cookingTime": 20,
                  "cookingTools": ["íŒ¬", "ì£¼ê±±"],
                  "servings": 2.0,
                  "ingredients": [
                    { "name": "ì£¼ì¬ë£ŒA", "quantity": "100", "unit": "g", "customPrice": 50, "customCalories": 300.0, "customCarbohydrate": 20.50, "customProtein": 35.00, "customFat": 10.00, "customSugar": 5.00, "customSodium": 150 },
                    { "name": "ì£¼ì¬ë£ŒB", "quantity": "1", "unit": "ê°œ" },
                    { "name": "ë³´ì¡°ì¬ë£ŒC", "quantity": "1", "unit": "ì‘ì€ìˆ " }
                  ],
                  "steps": [
                    { "stepNumber": 0, "instruction": "ì¬ë£Œë¥¼ ì†ì§ˆí•©ë‹ˆë‹¤.", "action": "ì†ì§ˆí•˜ê¸°" },
                    { "stepNumber": 1, "instruction": "íŒ¬ì— ì¬ë£Œë¥¼ ë³¶ìŠµë‹ˆë‹¤.", "action": "ë³¶ê¸°" }
                  ],
                  "tags": ["ğŸ½ï¸ í˜¼ë°¥"],
                  "marketPrice": 8000,
                   "cookingTips": "íŒ1. íŒ2. íŒ3."
                }
                """;

        String requestContext = """
                ìš”ì²­ ì¡°ê±´:
                - ìš”ë¦¬ ìœ í˜•: %s
                %s
                %s
                - ë§¤ìš´ë§› ì„ í˜¸ë„: %s/5
                - ì•Œë ˆë¥´ê¸° ì •ë³´: %s
                - ìš”ë¦¬ í…Œë§ˆ ì„ í˜¸ íƒœê·¸: %s
                - ì£¼ìš” ì¬ë£Œ: %s
                - íƒœê·¸: %s
                """.formatted(
                request.getDishType() != null && !request.getDishType().isBlank() ? request.getDishType() : "AI ìë™ ì„ íƒ",
                cookingTimePart,
                servingsPart,
                spicePref != null ? spicePref : "ê¸°ë³¸",
                allergyPref != null && !allergyPref.isBlank() ? allergyPref : "ì—†ìŒ",
                tagsJson,
                ingredientsWithUnits,
                tagsJson
        );

        return systemAndBaseRules
                + "\n\n--- ì˜ˆì‹œ JSON ---\n"
                + fewShotExample
                + "\n--- ì˜ˆì‹œ ë ---\n"
                + "\n\n" + requestContext
                + "\n\n" + jsonFormatRules;
    }

    public String buildAnalysisPrompt(Recipe recipe) {
        String ingredientsStr = (recipe.getIngredients() != null)
                ? recipe.getIngredients().stream()
                .map(ri -> {
                    String name = (ri.getIngredient() != null) ? ri.getIngredient().getName() : ri.getCustomName();
                    String quantity = ri.getQuantity() != null ? ri.getQuantity() : "";
                    String unit = ri.getUnit() != null ? ri.getUnit() : "";

                    return String.format("%s(%s %s)", name, quantity, unit).trim().replace("  ", " ");
                })
                .collect(Collectors.joining(", "))
                : "ì¬ë£Œ ì •ë³´ ì—†ìŒ";

        String stepsStr = (recipe.getSteps() != null)
                ? recipe.getSteps().stream()
                .sorted(Comparator.comparing(RecipeStep::getStepNumber))
                .map(step -> step.getStepNumber() + ". " + step.getInstruction())
                .collect(Collectors.joining("\n"))
                : "ì¡°ë¦¬ ê³¼ì • ì •ë³´ ì—†ìŒ";

        Set<String> tools = recipe.getCookingTools();
        String toolsStr = (tools != null && !tools.isEmpty()) ? String.join(", ", tools) : "ì¼ë°˜ ì¡°ë¦¬ ë„êµ¬";

        String description = recipe.getDescription() != null ? recipe.getDescription() : "ì„¤ëª… ì—†ìŒ";
        String servings = recipe.getServings() != null ? String.valueOf(recipe.getServings()) : "1";
        String dishTypeStr = recipe.getDishType() != null ? recipe.getDishType().name() : "ê¸°íƒ€";

        return """
                ë„ˆëŠ” í•œêµ­ ë°°ë‹¬ ìŒì‹ ì‹œì¥ ê°€ê²© ë¶„ì„ê³¼ ì‹í’ˆ ìœ„ìƒ/ì•ˆì „ ì „ë¬¸ê°€ì•¼.
                ë‹¤ìŒ ë ˆì‹œí”¼ ë°ì´í„°ë¥¼ ë¶„ì„í•˜ì—¬ **ì˜¤ì§ JSON í˜•ì‹**ìœ¼ë¡œë§Œ ì‘ë‹µí•´. (ë§ˆí¬ë‹¤ìš´, ì„œë¡ , ê²°ë¡  ê¸ˆì§€)
                        
                **[ë ˆì‹œí”¼ ì •ë³´]**
                - ìš”ë¦¬ëª…: %s
                - ì„¤ëª…: %s
                - ì¢…ë¥˜: %s
                - ì¸ë¶„: %sì¸ë¶„
                - ì¡°ë¦¬ ë„êµ¬: %s
                        
                **[ì¬ë£Œ ëª©ë¡]**
                %s
                        
                **[ì¡°ë¦¬ ê³¼ì •]**
                %s
                        
                ---------------------------------------------------
                        
                **[ì¶œë ¥ í•„ë“œ ë° ì‘ì„± ê·œì¹™]**
                        
                1. "marketPrice" (Integer):
                   - ìœ„ ë ˆì‹œí”¼ê°€ **%sì¸ë¶„**ì„ì„ ê°ì•ˆí•˜ì—¬ ê°€ê²©ì„ ì±…ì •í•´.
                   - 'ë°°ë‹¬ì˜ë¯¼ì¡±'ì´ë‚˜ 'ìš”ê¸°ìš”' ê°™ì€ í•œêµ­ ë°°ë‹¬ ì•± ê¸°ì¤€ **ì ì • íŒë§¤ê°€**ì—¬ì•¼ í•´.
                   - ì¬ë£Œë¹„ + ì¸ê±´ë¹„ + í¬ì¥ë¹„ + ê°€ê²Œ ë§ˆì§„ + ë°°ë‹¬ ëŒ€í–‰ë£Œ ê°ì•ˆ ë¹„ìš©ì„ ëª¨ë‘ í¬í•¨í•˜ì—¬ **í˜„ì‹¤ì ì¸ ì™¸ì‹ ë¬¼ê°€(ë‹¤ì†Œ ë¹„ì‹¼ í¸)**ë¡œ ì¡ì•„ì•¼ í•´.
                   - (ì˜ˆ: êµ­ë°¥ 11,000, íŒŒìŠ¤íƒ€ 16,000, ë–¡ë³¶ì´ 1ì¸ë¶„ 5,000 ë“±)
                   
                2. "cookingTips" (String):
                   - í˜„ì¬ ì‚¬ìš© ê°€ëŠ¥í•œ ì¡°ë¦¬ ë„êµ¬(%s)ë‚˜ ì¬ë£Œ ìƒí™©ì„ ê³ ë ¤í•˜ì—¬ íŒì„ ì‘ì„±í•´.
                   - ìš”ë¦¬ì˜ ë§›ì„ í•œ ì¸µ ë” ì˜¬ë¦´ ìˆ˜ ìˆëŠ” ë¹„ë²•(ë§ˆì´ì•¼ë¥´, ë¶ˆì¡°ì ˆ ë“±)ì´ë‚˜ ì¬ë£Œ ëŒ€ì²´ íŒì„ **2~3ë¬¸ì¥ì˜ ì¤„ê¸€**ë¡œ ì‘ì„±í•´.
                   - **[ì¤‘ìš”] ì¬ë£Œë¥¼ ëŒ€ì²´í•  ê²ƒì„ ì¶”ì²œí•œë‹¤ë©´, ë°˜ë“œì‹œ êµ¬ì²´ì ì¸ ì–‘ì„ ëª…ì‹œí•´ì•¼ í•´.**
                     (ë‚˜ìœ ì˜ˆ: "ìš°ìœ  ëŒ€ì‹  ë‘ìœ ë¥¼ ì“°ì„¸ìš”.")
                     (ì¢‹ì€ ì˜ˆ: "ìš°ìœ ê°€ ì—†ë‹¤ë©´ ë‘ìœ  100mlë¡œ ëŒ€ì²´í•˜ì—¬ ë” ê³ ì†Œí•œ ë§›ì„ ë‚¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.")
                   - ë¬¸ì²´ëŠ” ì¹œì ˆí•˜ê³  ì „ë¬¸ì ì¸ 'ì‚¬ì¥ë‹˜ íŒ' ë§íˆ¬ë¡œ ì‘ì„±í•´ (~í•´ìš”, ~í•©ë‹ˆë‹¤).
                   
                3. "isAbusive" (Boolean):
                   - ë ˆì‹œí”¼ì˜ ì œëª©, ì„¤ëª…, ì¬ë£Œ, ì¡°ë¦¬ë²• ì „ì²´ ë‚´ìš©ì„ ë¶„ì„í•´.
                   - **ì‹¬í•œ ìš•ì„¤, ì„±ì  ë¹„í•˜, í­ë ¥ì  ë¬˜ì‚¬(ë™ë¬¼ í•™ëŒ€ ë“±), í˜ì˜¤ í‘œí˜„, ê´‘ê³ ì„± ë„ë°°**ê°€ í¬í•¨ë˜ì–´ ìˆëŠ”ì§€ ì—„ê²©í•˜ê²Œ íŒë‹¨í•´.
                   - ë‹¨ìˆœíˆ ë ˆì‹œí”¼ê°€ ë§›ì—†ì–´ ë³´ì´ê±°ë‚˜, ì„¤ëª…ì´ ë¶€ì¡±í•˜ê±°ë‚˜, ì˜¤íƒ€ê°€ ìˆëŠ” ê²½ìš°ëŠ” `false`ì•¼.
                   - ìš´ì˜ ì •ì±…ì„ ìœ„ë°˜í•˜ëŠ” ì‹¬ê°í•œ ë‚´ìš©ì¼ ê²½ìš°ì—ë§Œ `true`ë¥¼ ë°˜í™˜í•´.
                        
                [JSON ì¶œë ¥ ì˜ˆì‹œ]
                {
                  "marketPrice": 14500,
                  "cookingTips": "ë§ˆì§€ë§‰ì— íŠ¸ëŸ¬í”Œ ì˜¤ì¼ì„ ë‘ ë°©ìš¸ ë–¨ì–´ëœ¨ë¦¬ë©´ í’ë¯¸ê°€ ì‚´ì•„ë‚©ë‹ˆë‹¤. ìƒí¬ë¦¼ì´ ì—†ë‹¤ë©´ ìš°ìœ  150mlì™€ ë²„í„° 10gì„ ì„ì–´ ì‚¬ìš©í•´ë„ ì¢‹ìŠµë‹ˆë‹¤.",
                  "isAbusive": false
                }
                """.formatted(
                recipe.getTitle(),
                description,
                dishTypeStr,
                servings,
                toolsStr,
                ingredientsStr,
                stepsStr,
                servings,
                toolsStr
        );
    }
}
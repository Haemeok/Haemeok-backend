<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8" />
    <title>WebSocket ì•Œë¦¼ í…ŒìŠ¤íŠ¸</title>
    <script src="https://cdn.jsdelivr.net/npm/sockjs-client@1/dist/sockjs.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/stompjs@2.3.3/lib/stomp.min.js"></script>
    <style>
        body { font-family: sans-serif; padding: 1rem; }
        #log { background: #f5f5f5; padding: .5rem; max-height: 300px; overflow-y: auto; }
        #controls { margin-bottom: 1rem; }
        button { padding: .5rem 1rem; }
    </style>
</head>
<body>
<h1>WebSocket ì•Œë¦¼ í…ŒìŠ¤íŠ¸</h1>
<div id="controls">
    <button id="connectBtn">ì—°ê²°í•˜ê¸°</button>
</div>
<div id="log"></div>

<script>
    const logEl = document.getElementById('log');
    const log = msg => {
        const p = document.createElement('div');
        p.textContent = msg;
        logEl.appendChild(p);
        logEl.scrollTop = logEl.scrollHeight;
    };

    let client;

    document.getElementById('connectBtn').addEventListener('click', () => {
        if (client) {
            log('âš ï¸ ì´ë¯¸ ì—°ê²°ë˜ì–´ ìˆìŠµë‹ˆë‹¤.');
            return;
        }
        connectWebSocket();
    });

    function connectWebSocket() {
        log('Opening WebSocket...');
        // â–¶ í† í° ì¿¼ë¦¬ ì—†ì´, ì¿ í‚¤ì— ë‹´ê¸´ accessTokenì´ ìë™ìœ¼ë¡œ ì „ì†¡ë¨
        const socket = new SockJS('/ws/notifications');
        client = Stomp.over(socket);

        client.connect(
            {},  // í—¤ë” ëŒ€ì‹  ë¹ˆ ê°ì²´
            frame => {
                log('âœ… ì—°ê²° ì„±ê³µ: ' + (frame.headers['user-name'] || 'ì¸ì¦ ì„±ê³µ'));
                client.subscribe('/user/queue/notifications', msg => {
                    log('ğŸ”” ì•Œë¦¼ ìˆ˜ì‹ : ' + msg.body);
                });
            },
            error => {
                log('âŒ ì—°ê²° ì—ëŸ¬: ' + error);
                client = null;
            }
        );
    }
</script>
</body>
</html>